# Система логирования

## Интеграция в проект

### 1. Установка зависимостей
Система использует стандартный модуль Python `logging` и не требует установки дополнительных пакетов.

### 2. Настройка проекта
Добавьте в основной файл приложения (обычно `app.py` или `main.py`):

```python
# Импорт и инициализация логгера
from logger import setup_logging, get_module_logger

# Настройка корневого логгера
logger = setup_logging()
```

### 3. Использование в модулях
В каждом модуле/файле вашего проекта импортируйте и используйте:

```python
from logger import get_module_logger

logger = get_module_logger(__name__)

# Примеры использования
logger.info("Информационное сообщение")
logger.warning("Предупреждение")
logger.error("Ошибка")
logger.debug("Отладочная информация")
```
### 4. Настройка конфигурации
Все настройки логирования хранятся в файле logging_constants.py. Для изменения:

- Уровней логирования
- Форматов сообщений
- Путей к лог-файлам
- Параметров ротации логов

Отредактируйте соответствующие константы в этом файле.

## Как работает система логирования
#### Архитектура
```text
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Модули        │───▶│   Логгеры       │───▶│   Обработчики   │
│   приложения    │    │   (logging)     │    │   (Handlers)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                   │
                                         ┌─────────┼─────────┐
                                         │         │         │
                                   ┌─────▼──┐ ┌───▼────┐ ┌──▼───────┐
                                   │  Файл  │ │ Ошибки │ │ Консоль  │
                                   │ app.log│ │error.log│ │(stderr) │
                                   └────────┘ └────────┘ └──────────┘
```

### Два режима работы
#### Режим разработки (DEVELOPMENT)

- Логи: выводятся только в консоль
- Уровень: INFO и выше
- Цель: удобство отладки при разработке

#### Продакшен режим (WSGI)
- app.log: все сообщения уровня INFO и выше с ротацией каждые 3 дня
- error.log: только ERROR и CRITICAL с аналогичной ротацией
- Консоль: только ERROR и CRITICAL (для мониторинга в контейнерах)

### Ротация логов
В продакшен режиме используется TimedRotatingFileHandler:

- Период: каждые 3 дня
- Хранение: 10 файлов (30 дней истории)
- Имена файлов: app.log.2023-12-01, error.log.2023-12-01

### Формат сообщений
Все сообщения форматируются в едином стиле:

```text
2023-12-01 10:30:45 - app.module_name - INFO - Сообщение
```

### Иерархия логгеров
- Корневой логгер: "app"
- Модульные логгеры: "app.module_name"
- Поддерживается наследование настроек от родительских логгеров

### Конфигурирование через константы
Все параметры вынесены в logging_constants.py:

- LOG_LEVEL- 	Уровень логирования	"INFO"
- LOG_FORMAT	Формат сообщений	%(asctime)s - %(name)s - %(levelname)s - %(message)s
- LOG_DIR	Директория для логов	/opt/foresight/mail-orchestrator/logs
- LOG_ROTATION_INTERVAL	Интервал ротации (дни)	3

### Безопасность

- Автоматическое создание директории для логов
- UTF-8 кодировка всех файлов
- Очистка старых лог-файлов (сохранение только последних 30 дней)

### Мониторинг
Для мониторинга в продакшене:

- Следите за размером лог-директории
- Настройте алерты на критические ошибки (уровень ERROR)
- Используйте error.log для анализа проблем

### Расширение
Для добавления нового обработчика (например, отправка в Sentry):

- Добавьте новый handler в setup_production_logging()
- Настройте его уровень и форматтер
- Добавьте его в logger с помощью logger.addHandler()
